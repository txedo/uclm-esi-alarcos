\chapter{Manual de Instalación y Despliegue}
\label{ch:manualinstalacion}

El sistema de visualización que se ha desarrollado con la elaboración de este PFC consta de dos componentes cuyo código fuente se puede encontrar en el DVD adjunto a esta documentación. El ciclo de vida de ambos ha sido gestionado mediante Maven 2.2.1, lo que facilita el proceso de construcción y despliegue de los mismos. No obstante, si no desea lidiar con Maven, puede instalar una base de datos de prueba mediante el script \textit{install.sql} y desplegar el fichero \textit{desglosa-web.war} en un servidor web tipo Apache Tomcat. Ambos ficheros se encuentran bajo el directorio \textit{dist}.

Si por el contrario prefiere construir ambos proyectos, siga los pasos que se detallan a continuación.



\section{Instalación de las librerías de JOGL en el repositorio local de Maven}

La versión de JOGL empleada en este PFC es la 2.0. Esta versión no se encuentra disponible en los repositorios oficiales de Maven, por lo que deberá ser descargada de la página oficial de JOGL \cite{site:jogl} (también se proporciona en el DVD adjunto a este PFC) e instalada en el repositorio local de Maven.

Para comenzar el proceso abra un terminal, diríjase a la ruta en la que se encuentre el proyecto \textbf{desglosa} (motor gráfico) y navegue a través de la ruta de directorios \textit{builds - jogamp - deployment - webstart - archive}. En este directorio encontrará numerosos archivos cuyos nombres se corresponden con la estructura \textit{librería-versión-plataforma-arquitectura.7z}. Por ejemplo, el fichero \textit{jogl-2.0-b20-20110302-windows-amd64.7z} se corresponde con la librería jogl, versión 2.0, plataforma Microsoft Windows y arquitectura de 64 bits.

Descomprima el fichero \textit{jogl-2.0-b23-20110303-x-y.7z}, donde \textit{x} se corresponde con su sistema operativo e \textit{y} con la arquitectura de su máquina. Sitúese en el directorio \textit{jar} y ejecute los comandos del listado \ref{lst:mvn-install} en un terminal. Esto añadirá las librerías a su repositorio local de Maven.

\begin{lstlisting}[caption={Comandos para la instalación de librerías en el repositorio local de Maven},label=lst:mvn-install]
mvn install:install-file -Dfile=gluegen-rt.jar -DgroupId=com.jogamp.gluegen -DartifactId=gluegen-rt -Dversion=2.0-b23-20110303 -Dpackaging=jar

mvn install:install-file -Dfile=jogl.all.jar -DgroupId=com.jogamp.jogl -DartifactId=jogl.all -Dversion=2.0-b23-20110303 -Dpackaging=jar

mvn install:install-file -Dfile=nativewindow.all.jar -DgroupId=com.jogamp.nativewindow -DartifactId=nativewindow.all -Dversion=2.0-b23-20110303 -Dpackaging=jar

mvn install:install-file -Dfile=newt.all.jar -DgroupId=com.jogamp.newt -DartifactId=newt.all -Dversion=2.0-b23-20110303 -Dpackaging=jar
\end{lstlisting}


\section{Construcción de los proyectos}

En el DVD adjunto a este PFC se encuentran dos directorios llamados \textit{desglosa} y \textit{desglosa-web}. El primero de ellos contiene todos los ficheros relativos al motor gráfico y el segundo a la aplicación web.

Como ya se ha argumentado a lo largo de esta documentación, la aplicación web contiene al motor gráfico. La ubicación del motor gráfico dentro de la aplicación web se encuentra en el directorio \textit{desglosa-web\textbackslash{}src\textbackslash{}main\textbackslash{}webapp\textbackslash{}applet\textbackslash{}desglosa.jar}. Actualmente incluye la última versión de éste, por lo que no es necesario volver a construir el fichero JAR. No obstante, generar una nueva versión del mismo es tan sencillo como ejecutar el comando \textit{mvn package} en el directorio del proyecto \textit{desglosa} y sustituir el viejo fichero \textit{jar} por el nuevo.

A continuación, si ejecuta el comando \textit{``mvn -DskipTests -Pprod package''} bajo el directorio \textit{desglosa-web}, creará la base de datos con el \textit{dataset} de prueba y generará un nuevo fichero WAR que podrá ser desplegado en cualquier contenedor de servlets como Apache Tomcat. Es posible que si el servidor de bases de datos no se encuentra en la máquina en la que esté operando deba editar el fichero \textit{pom.xml}, ya que por defecto se especifica éste se encuentra en \textit{localhost@3306}.

También existe la posibilidad de desplegar la aplicación mediante un plugin de Maven llamado Jetty. Jetty es un contenedor de servlets completamente funcional y puede emplearse para comprobar el funcionamiento de la aplicación. Para desplegar la aplicación automáticamente en este servidor ejecute el comando \textit{``mvn jetty:run -Dmaven.skip.test=true -Pprod''} o \textit{``mvn jetty:run-war -DskipTests -pProd''}.



%
%La construcción y configuración del entorno de desarrollo que se ha empleado durante la elaboración de este PFC no es trivial. Por esta razón, y con el propósito de facilitar las labores de mantenimiento, se facilita este manual en el cual se indica cómo abordar la instalación y configuración del mismo.
%
%El proceso se divide en los siguientes pasos:
%\begin{itemize}
%	\item Instalación del JRE (Java Runtime Environment) y JDK (Java Development Kit) de Java. Este paso no se detalla en este manual ya que es trivial.
%	\item Instalación y configuración de Maven.
%	\item Instalación de Eclipse EE Helios. Este paso no se detalla en este manual ya que es trivial.
%	\item Instalación y configuración de \textit{m2eclipse}.
%	\item Instalación de las librerías de JOGL (Java Binding for OpenGL) en el repositorio local de Maven.
%	\item Integración de Maven en eclipse para facilitar tareas de depuración.
%\end{itemize}
%
%
%\section{Instalación y configuración de Maven}
%
%Para comenzar, deberá dirigirse al sitio web de Maven y descargar la versión 2.2.1, que es la que se ha utilizado en el desarrollo de este PFC.
%
%Descomprima el fichero \textit{.zip} en el directorio que desee (se recomienda una ruta de directorios que no contenga espacios) y proceda a configurar las variables de entorno -M2, M2\_HOME y MAVEN\_OPTS- que se muestran en la figura \ref{fig:environment-variables}.
%
%\imagen{InstallManual//environment-variables}{2.2}{Variables de entorno de Maven}{fig:environment-variables}
%
%Si ha realizado la configuración correctamente y ejecuta el comando \textit{mvn -v} en un terminal, obtendrá una salida similar a la que se muestra en la figura \ref{fig:mvn-version}.
%
%\imagen{InstallManual//mvn-version}{2.1}{Resultado positivo de la ejecución del comando \textit{mvn -v} en un terminal}{fig:mvn-version}
%
%
%
%\section{Instalación y configuración de \textit{m2eclipse}}
%
%
%
%\section{Instalación de las librerías de JOGL en el repositorio local de Maven}
%
%La versión de JOGL empleada en este PFC es la 2.0. Esta versión no se encuentra disponible en los repositorios oficiales de Maven, por lo que deberá ser descargada de la página oficial de JOGL \cite{site:jogl} (también se proporcionan en el DVD adjunto a este PFC) e instalada en el repositorio local de Maven.
%
%Para comenzar el proceso abra un terminal, diríjase a la ruta en la que se encuentre el proyecto \textbf{desglosa} (motor gráfico)y navegue a través de la ruta de directorios \textit{builds\textbackslash{}jogamp\textbackslash{}deployment\textbackslash{}webstart\textbackslash{}archive}. En este directorio encontrará numerosos archivos cuyos nombres se corresponden con la estructura \textit{librería-versión-plataforma-arquitectura.7z}. Por ejemplo, el fichero \textit{jogl-2.0-b20-20110302-windows-amd64.7z} se corresponde con la librería jogl, versión 2.0, plataforma Microsoft Windows y arquitectura de 64 bits.
%
%Descomprima el fichero \textit{jogl-2.0-b23-20110303-x-y.7z}, donde \textit{x} se corresponde con su sistema operativo y \textit{y} se corresponde con la arquitectura de su máquina, y copie el contenido del directorio \textit{lib} al directorio raíz del directorio del motor gráfico. Después de realizar esta operación, el directorio raíz del proyecto \textbf{desglosa} debe contener las librerías \textit{gluegen-rt.*}, \textit{jogl\_desktop.*}, \textit{jogl\_es1.*}, \textit{jogl\_es2.*}, \textit{nativewindow\_awt.*}, \textit{nativewindow\_win32.*} y \textit{newt.*}.
%
%Acto seguido, para que Eclipse tenga conocimiento de la existencia de librerías nativas, será necesario añadir esta ruta en la variable \textit{``Native library location''} de Java \textit{Build Path -> Libraries -> Maven Dependencies} (Fig. \ref{fig:eclipse-java-build-path}).
%
%\imagen{InstallManual//eclipse-java-build-path}{2.0}{Configuración de librerías nativas en Eclipse}{fig:eclipse-java-build-path}
%
%A continuación, se añadirán al repositorio local de Maven las librerías necesarias contenidas en el directorio \textit{jar} del fichero descomprimido. Para ello se ejecutarán los siguientes comandos del listado \ref{lst:mvn-install} en un terminal.
%
%\begin{lstlisting}[caption={Comandos para la instalación de librerías en el repositorio local de Maven},label=lst:mvn-install]
%mvn install:install-file -Dfile=gluegen-rt.jar -DgroupId=com.jogamp.gluegen -DartifactId=gluegen-rt -Dversion=2.0-b23-20110303 -Dpackaging=jar
%
%mvn install:install-file -Dfile=jogl.all.jar -DgroupId=com.jogamp.jogl -DartifactId=jogl.all -Dversion=2.0-b23-20110303 -Dpackaging=jar
%
%mvn install:install-file -Dfile=nativewindow.all.jar -DgroupId=com.jogamp.nativewindow -DartifactId=nativewindow.all -Dversion=2.0-b23-20110303 -Dpackaging=jar
%
%mvn install:install-file -Dfile=newt.all.jar -DgroupId=com.jogamp.newt -DartifactId=newt.all -Dversion=2.0-b23-20110303 -Dpackaging=jar
%\end{lstlisting}
%
%Para finalizar, es necesario actualizar el índice de librerías de Maven. Para ello, dentro de Eclipse mostramos la vista ``maven repositories'' \textit{(Window -> Show view -> Other... -> Maven -> Maven repositories)}, se efectúa un clic derecho sobre \textit{local repository} y se lanza la operación \textit{rebuild index}.
%
%\imagen{InstallManual//mvn-rebuild-index}{2.0}{Actualización del índice de librerías de Maven}{fig:mvn-rebuild-index}
%
%
%
%\section{Integración de Maven en eclipse para facilitar tareas de depuración}