<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE struts PUBLIC 
    "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd">

<struts>
	<!-- When adding an action in struts.xml, edit applicationContext.xml to instantiate it by Spring -->
	<package name="struts" namespace="/" extends="struts-default">
		<!-- Interceptors -->
	    <interceptors>
	    	<!-- Interceptor to pass messages between actions -->
	    	<interceptor name="redirectMessage" class="redirectMessageInterceptor" />
	    	<interceptor-stack name="redirectMessageAndParams">
            	<interceptor-ref name="redirectMessage"/>
            	<interceptor-ref name="paramsPrepareParamsStack"/>
            </interceptor-stack>
            <!-- Interceptor to handle roles and actions -->
            <interceptor name="adminOnly" class="adminInterceptor"/>
            <interceptor name="executiveOnly" class="executiveInterceptor"/>
            <interceptor name="managerOnly" class="managerInterceptor"/>
            <interceptor name="allUsers" class="allUsersInterceptor"/>
            <interceptor-stack name="allButUsers">
            	<interceptor-ref name="adminOnly"/>
            	<interceptor-ref name="executiveOnly"/>
            	<interceptor-ref name="managerOnly"/>
            	<interceptor-ref name="defaultStack" />
            </interceptor-stack>
        </interceptors>
        
        <!-- Actions -->
        <action name="">
			<result>/index.jsp</result>
		</action>
		<action name="index">
			<result>/index.jsp</result>
		</action>
		<action name="login">
			<result>/login.jsp</result>
		</action>
		<action name="logout">
			<result>/logout.jsp</result>
		</action>
		<action name="contactUs">
			<result>/contactUs.jsp</result>
		</action>
		<action name="visualization" class="visualizationAction">
			<!-- <interceptor-ref name="allButUsers"/> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="success">/jsp/visualization.jsp</result>
			<result name="input">/jsp/visualization.jsp</result>
			<result name="error">/jsp/visualization.jsp</result>
		</action>
		
		<!-- Profile related actions -->
		<action name="listProfiles" class="profileAction">
			<!-- <interceptor-ref name="allUsers"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/admin/viewProfiles.jsp</result>
			<result name="input">/jsp/admin/viewProfiles.jsp</result>
			<result name="success">/jsp/admin/viewProfiles.jsp</result>
		</action>
		<action name="showProfileForm" class="profileAction" method="showForm">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/admin/viewProfiles.jsp</result>
			<result name="input">/jsp/admin/formProfile.jsp</result>
			<result name="success">/jsp/admin/formProfile.jsp</result>
		</action>
		<action name="saveProfile" class="profileAction" method="save">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/admin/formProfile.jsp</result>
			<result name="input">/jsp/admin/formProfile.jsp</result>
			<result name="success" type="redirectAction">listProfiles</result>
		</action>
        <action name="deleteProfile" class="profileAction" method="delete">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/admin/viewProfiles.jsp</result>
            <result name="input">/jsp/admin/viewProfiles.jsp</result>
            <result name="success" type="redirectAction">listProfiles</result>
        </action>
		<!-- End of Profile related actions -->
		
		<!-- Company related actions -->
		<action name="listCompanies" class="companyAction">
			<!-- <interceptor-ref name="allUsers"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/viewCompanies.jsp</result>
			<result name="input">/jsp/viewCompanies.jsp</result>
			<result name="success">/jsp/viewCompanies.jsp</result>
		</action>
		<action name="showCompanyForm" class="companyAction" method="showForm">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/viewCompanies.jsp</result>
			<result name="input">/jsp/formCompany.jsp</result>
			<result name="success">/jsp/formCompany.jsp</result>
		</action>
		<action name="viewCompany" class="companyAction" method="get">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/viewCompany.jsp</result>
			<result name="input">/jsp/viewCompany.jsp</result>
			<result name="success">/jsp/viewCompany.jsp</result>
		</action>
		<action name="saveCompany" class="companyAction" method="save">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/formCompany.jsp</result>
			<result name="input">/jsp/formCompany.jsp</result>
			<result name="success" type="redirectAction">listCompanies</result>
		</action>
		<action name="editCompany" class="companyAction" method="edit">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/viewCompanies.jsp</result>
			<result name="input">/jsp/formCompany.jsp</result>
			<result name="success" type="redirectAction">listCompanies</result>
		</action>
		<action name="deleteCompany" class="companyAction" method="delete">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/viewCompanies.jsp</result>
			<result name="input">/jsp/viewCompanies.jsp</result>
			<result name="success" type="redirectAction">listCompanies</result>
		</action>
		<action name="viewCompanyMeasures" class="companyAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewCompanyMeasures.jsp</result>
            <result name="input">/jsp/viewCompanyMeasures.jsp</result>
            <result name="success">/jsp/viewCompanyMeasures.jsp</result>
        </action>
        <action name="configureCompanyMeasures" class="companyAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/formCompanyMeasures.jsp</result>
            <result name="input">/jsp/formCompanyMeasures.jsp</result>
            <result name="success">/jsp/formCompanyMeasures.jsp</result>
        </action>
        <action name="editCompanyMeasures" class="companyAction" method="updateMeasures">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewCompanies.jsp</result>
            <result name="input">/jsp/formCompanyMeasures.jsp</result>
            <result name="success" type="redirectAction">listCompanies</result>
        </action>
		<!-- End of Company related actions -->
		
		<!-- Factory related actions -->
		<action name="listFactories" class="factoryAction">
			<!-- <interceptor-ref name="allUsers"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/viewFactories.jsp</result>
			<result name="input">/jsp/viewFactories.jsp</result>
			<result name="success">/jsp/viewFactories.jsp</result>
		</action>
		<action name="showFactoryForm" class="factoryAction" method="showForm">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/formFactory.jsp</result>
			<result name="input">/jsp/formFactory.jsp</result>
			<result name="success">/jsp/formFactory.jsp</result>
		</action>
        <action name="viewFactory" class="factoryAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewFactory.jsp</result>
            <result name="input">/jsp/viewFactory.jsp</result>
            <result name="success">/jsp/viewFactory.jsp</result>
        </action>
		<action name="saveFactory" class="factoryAction" method="save">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/formFactory.jsp</result>
			<result name="input">/jsp/formFactory.jsp</result>
			<result name="success" type="redirectAction">listFactories</result>
		</action>
		<action name="editFactory" class="factoryAction" method="edit">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/viewFactories.jsp</result>
			<result name="input">/jsp/formFactory.jsp</result>
			<result name="success" type="redirectAction">listFactories</result>
		</action>
		<action name="deleteFactory" class="factoryAction" method="delete">
			<!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
			<interceptor-ref name="redirectMessageAndParams"/>
			<result name="error">/jsp/viewFactories.jsp</result>
			<result name="input">/jsp/viewFactories.jsp</result>
			<result name="success" type="redirectAction">listFactories</result>
		</action>
        <action name="viewFactoryMeasures" class="factoryAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewFactoryMeasures.jsp</result>
            <result name="input">/jsp/viewFactoryMeasures.jsp</result>
            <result name="success">/jsp/viewFactoryMeasures.jsp</result>
        </action>
        <action name="configureFactoryMeasures" class="factoryAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/formFactoryMeasures.jsp</result>
            <result name="input">/jsp/formFactoryMeasures.jsp</result>
            <result name="success">/jsp/formFactoryMeasures.jsp</result>
        </action>
        <action name="editFactoryMeasures" class="factoryAction" method="updateMeasures">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewFactories.jsp</result>
            <result name="input">/jsp/formFactoryMeasures.jsp</result>
            <result name="success" type="redirectAction">listFactories</result>
        </action>
		<!-- End of Factory related actions -->
		
        <!-- Project related actions -->
        <action name="listProjects" class="projectAction">
            <!-- <interceptor-ref name="allUsers"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewProjects.jsp</result>
            <result name="input">/jsp/viewProjects.jsp</result>
            <result name="success">/jsp/viewProjects.jsp</result>
        </action>
        <action name="showProjectForm" class="projectAction" method="showForm">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/formProject.jsp</result>
            <result name="input">/jsp/formProject.jsp</result>
            <result name="success">/jsp/formProject.jsp</result>
        </action>
        <action name="viewProject" class="projectAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewProject.jsp</result>
            <result name="input">/jsp/viewProject.jsp</result>
            <result name="success">/jsp/viewProject.jsp</result>
        </action>
        <action name="saveProject" class="projectAction" method="save">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/formProject.jsp</result>
            <result name="input">/jsp/formProject.jsp</result>
            <result name="success" type="redirectAction">listProjects</result>
        </action>
        <action name="editProject" class="projectAction" method="edit">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewProjects.jsp</result>
            <result name="input">/jsp/formProject.jsp</result>
            <result name="success" type="redirectAction">listProjects</result>
        </action>
        <action name="deleteProject" class="projectAction" method="delete">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewProjects.jsp</result>
            <result name="input">/jsp/viewProjects.jsp</result>
            <result name="success" type="redirectAction">listProjects</result>
        </action>
        <action name="viewProjectMeasures" class="projectAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewProjectMeasures.jsp</result>
            <result name="input">/jsp/viewProjectMeasures.jsp</result>
            <result name="success">/jsp/viewProjectMeasures.jsp</result>
        </action>
        <action name="configureProjectMeasures" class="projectAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/formProjectMeasures.jsp</result>
            <result name="input">/jsp/formProjectMeasures.jsp</result>
            <result name="success">/jsp/formProjectMeasures.jsp</result>
        </action>
        <action name="editProjectMeasures" class="projectAction" method="updateMeasures">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewProjects.jsp</result>
            <result name="input">/jsp/formProjectMeasures.jsp</result>
            <result name="success" type="redirectAction">listProjects</result>
        </action>
        <!-- End of Project related actions -->
        
        <!-- Subproject related actions -->
        <action name="listSubprojects" class="subprojectAction">
            <!-- <interceptor-ref name="allUsers"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewSubprojects.jsp</result>
            <result name="input">/jsp/viewSubprojects.jsp</result>
            <result name="success">/jsp/viewSubprojects.jsp</result>
        </action>
        <action name="showSubprojectForm" class="subprojectAction" method="showForm">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/formSubproject.jsp</result>
            <result name="input">/jsp/formSubproject.jsp</result>
            <result name="success">/jsp/formSubproject.jsp</result>
        </action>
        <action name="viewSubproject" class="subprojectAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewSubproject.jsp</result>
            <result name="input">/jsp/viewSubproject.jsp</result>
            <result name="success">/jsp/viewSubproject.jsp</result>
        </action>
        <action name="saveSubproject" class="subprojectAction" method="save">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/formSubproject.jsp</result>
            <result name="input">/jsp/formSubproject.jsp</result>
            <result name="success" type="redirectAction">listSubprojects</result>
        </action>
        <action name="editSubproject" class="subprojectAction" method="edit">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewSubprojects.jsp</result>
            <result name="input">/jsp/formSubproject.jsp</result>
            <result name="success" type="redirectAction">listSubprojects</result>
        </action>
        <action name="deleteSubproject" class="subprojectAction" method="delete">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewSubprojects.jsp</result>
            <result name="input">/jsp/viewSubprojects.jsp</result>
            <result name="success" type="redirectAction">listSubprojects</result>
        </action>
        <action name="viewSubprojectMeasures" class="subprojectAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewSubprojectMeasures.jsp</result>
            <result name="input">/jsp/viewSubprojectMeasures.jsp</result>
            <result name="success">/jsp/viewSubprojectMeasures.jsp</result>
        </action>
        <action name="configureSubprojectMeasures" class="subprojectAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/formSubprojectMeasures.jsp</result>
            <result name="input">/jsp/formSubprojectMeasures.jsp</result>
            <result name="success">/jsp/formSubprojectMeasures.jsp</result>
        </action>
        <action name="editSubprojectMeasures" class="subprojectAction" method="updateMeasures">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/viewSubprojects.jsp</result>
            <result name="input">/jsp/formSubprojectMeasures.jsp</result>
            <result name="success" type="redirectAction">listSubprojects</result>
        </action>
        <!-- End of Subproject related actions -->
        
        <!-- Plain report builders -->
        <action name="getCompanyPlainReport" class="companyAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/buildCompanyPlainReport.jsp</result>
            <result name="input">/jsp/buildCompanyPlainReport.jsp</result>
            <result name="success">/jsp/buildCompanyPlainReport.jsp</result>
        </action>
        <action name="getFactoryPlainReport" class="factoryAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/buildFactoryPlainReport.jsp</result>
            <result name="input">/jsp/buildFactoryPlainReport.jsp</result>
            <result name="success">/jsp/buildFactoryPlainReport.jsp</result>
        </action>
        <action name="getProjectPlainReport" class="projectAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/buildProjectPlainReport.jsp</result>
            <result name="input">/jsp/buildProjectPlainReport.jsp</result>
            <result name="success">/jsp/buildProjectPlainReport.jsp</result>
        </action>
        <action name="getSubprojectPlainReport" class="subprojectAction" method="get">
            <!-- <interceptor-ref name="adminOnly"></interceptor-ref> -->
            <interceptor-ref name="redirectMessageAndParams"/>
            <result name="error">/jsp/buildSubprojectPlainReport.jsp</result>
            <result name="input">/jsp/buildSubprojectPlainReport.jsp</result>
            <result name="success">/jsp/buildSubprojectPlainReport.jsp</result>
        </action>
        <!-- End of plain report builders -->
	</package>
	
	<package name="json" extends="json-default">
	
		<global-results>
		    <result name="input" type="json">
		        <param name="ignoreHierarchy">false</param>
		        <param name="includeProperties">actionErrors\[\d+\], fieldErrors\..+$, actionMessages\[\d+\]</param>
		    </result>
		    <result name="error" type="json">
		        <param name="ignoreHierarchy">false</param>
		        <param name="includeProperties">actionErrors\[\d+\], fieldErrors\..+$, actionMessages\[\d+\]</param>
		    </result>
		    <result name="Exception" type="json">
		        <param name="ignoreHierarchy">false</param>
		        <param name="includeProperties">actionErrors\[\d+\], fieldErrors\..+$, actionMessages\[\d+\]</param>
		    </result>
		</global-results>
		<global-exception-mappings>
		    <exception-mapping exception="java.lang.Throwable" result="Exception" />
		</global-exception-mappings>
	
		<action name="json_p_*" class="profileAction" method="{1}">
			<result name="success" type="json">
				<param name="noCache">true</param>
				<!-- <param name="excludeProperties">companies, projects</param> -->
				<!-- <param name="excludeNullProperties">true</param> -->
			</result>
		</action>
        <action name="json_m_*" class="marketAction" method="{1}">
            <result name="success" type="json">
                <param name="noCache">true</param>
                <!-- <param name="excludeProperties">companies, projects</param> -->
                <!-- <param name="excludeNullProperties">true</param> -->
            </result>
        </action>
		<action name="json_*" class="visualizationAction" method="{1}">
			<result name="success" type="json">
				<param name="noCache">true</param>
				<!-- <param name="excludeProperties">companies, projects</param> -->
				<!-- <param name="excludeNullProperties">true</param> -->
			</result>
		</action>
	</package>
</struts>
