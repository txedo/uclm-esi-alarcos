En esta iteración se resuelven los problemas detectados en la disciplina de pruebas de la iteración número 5 (Sección \ref{sec:iteracion-5-pruebas}).


\subsubsection{Disciplina de requisitos}
\label{sec:iteracion-5bis-requisitos}

El usuario experto que ha llevado a cabo las pruebas de la quinta iteración afirma que no percibe sensación de profundidad cuando visualiza la escena. Para resolver este problema se propone la generación de sombras en tiempo real y la adición de un \textit{skybox}\footnote{Método empleado en el área de los videojuegos que se basa en la adición de imágenes de fondo para conseguir que una escena parezca más grande de lo que realmente es.}.



\subsubsection{Disciplina de análisis}
\label{sec:iteracion-5bis-analisis}

Durante esta disciplina se analiza cómo resolver dos de las cuestiones que han surgido en referencia al motor gráfico: errores de visualización en las transparencias de las torres de la metáfora de ciudad y cálculo de sombras en tiempo real. Ambos casos tienen una estrecha relación con la posición de la cámara en la escena.

En primer lugar, para que el usuario perciba las transparencias correctamente, es necesario pintar los objetos de la escena desde los más lejanos a la cámara hasta los más cercanos. Por ello, es necesario diseñar algún algoritmo que, proporcionándole la lista de elementos -con sus coordenadas en la escena- y la posición de la cámara, calcule las distancias y las ordene de forma descendente. Este algoritmo deberá ser aplicado cada vez que se ejecute cualquier tipo de movimiento sobre la cámara ya que las distancias pueden variar.

En segundo lugar, para calcular las sombras en tiempo real será necesario realizar algunos cálculos en un espacio vectorial de tres dimensiones. Estos cálculos consisten en hallar el producto escalar entre el vector que indica la posición del foco de iluminación -que usualmente está junto a la cámara- y el vector normal del plano que representa el suelo de la escena. Este vector se calcula mediante el producto vectorial de dos vectores cualesquiera, teniendo en cuenta que el plano se encuentra en $y=0$. A partir de estos datos se calculará la matriz de proyección de las sombras, sobre la cual se volverán a pintar los elementos que conforman la escena, pero esta vez en color negro semi-transparente.


\subsubsection{Disciplina de diseño}
\label{sec:iteracion-5bis-diseño}

En esta disciplina se llevan a cabo los diseños de los algoritmos propuestos en la disciplina de análisis de esta misma iteración.



\subsubsection{Disciplina de implementación}
\label{sec:iteracion-5bis-implementacion}

Durante esta disciplina se lleva cabo la implementación del pintado de sombras en tiempo real, el \textit{skybox} que otorgará mayor sensación de profundidad y el algoritmo ordena los modelos gráficos en función de la distancia con respecto de la cámara para que las transparencias sean dibujadas correctamente.

En las figuras \ref{fig:it6-fixed-tests-it5} y \ref{fig:it6-jogl-mixed-screenshot} se muestran dos capturas de pantalla en las que se aprecia la evolución y el resultado de los gráficos generados.

\imagenBorde{Cap5//it6-fixed-tests-it5}{0.45}{Gráficos generados después de la disciplina de implementación de la sexta iteración: a la izquierda sin sombras ni \textit{skybox}; a la derecha con ambas características}{fig:it6-fixed-tests-it5}

\imagenBorde{Cap5//it6-jogl-mixed-screenshot}{0.25}{Gráficos generados después de la disciplina de implementación de la sexta iteración. De izquierda a derecha se muestran las metáforas de ciudad y polígono industrial y una representación de proyectos software}{fig:it6-jogl-mixed-screenshot}



\subsubsection{Disciplina de pruebas}
\label{sec:iteracion-5bis-pruebas}

En esta disciplina se han repetido los casos de prueba de la quinta iteración (Sección \ref{sec:iteracion-5-pruebas}) y se ha obtenido un resultado positivo. Por lo tanto, se procede a abordar la siguiente iteración.